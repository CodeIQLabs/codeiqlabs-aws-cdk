# Sample Manifest for Organizations Stack
# This manifest creates AWS Organizations with OUs and accounts
# Stack Created: ManagementOrganizationsStack

# yaml-language-server: $schema=https://schemas.codeiqlabs.dev/aws/manifest.schema.json

# ============================================================================
# CORE CONFIGURATION
# ============================================================================
project: "MyOrganization"
company: "MyCompany"

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================
deployment:
  accountId: "123456789012" # Your AWS management account ID
  region: "us-east-1"

# ============================================================================
# AWS ORGANIZATIONS CONFIGURATION
# ============================================================================
organization:
  enabled: true

  # Organization root ID (get from AWS Console or CLI)
  # Run: aws organizations list-roots
  rootId: "r-abc123"

  # Mode: "create" for new org, "adopt" for existing
  mode: "create"

  # Feature set: "ALL" or "CONSOLIDATED_BILLING"
  featureSet: "ALL"

  # Organizational Units and Accounts
  organizationalUnits:
    # Production OU
    - key: "production"
      name: "Production"
      description: "Production workload accounts"
      accounts:
        - key: "prod-app"
          name: "Production Application"
          email: "aws+prod-app@mycompany.com"
          environment: "prod"
          purpose: "Production application workloads"
          accountId: "234567890123" # Optional: specify if account exists

        - key: "prod-data"
          name: "Production Data"
          email: "aws+prod-data@mycompany.com"
          environment: "prod"
          purpose: "Production data and analytics"
          accountId: "345678901234"

    # Non-Production OU
    - key: "non-production"
      name: "Non-Production"
      description: "Development and staging accounts"
      accounts:
        - key: "dev"
          name: "Development"
          email: "aws+dev@mycompany.com"
          environment: "dev"
          purpose: "Development and testing"

        - key: "staging"
          name: "Staging"
          email: "aws+staging@mycompany.com"
          environment: "staging"
          purpose: "Pre-production staging"

    # Shared Services OU
    - key: "shared-services"
      name: "Shared Services"
      description: "Shared infrastructure and services"
      accounts:
        - key: "networking"
          name: "Networking"
          email: "aws+networking@mycompany.com"
          environment: "shared"
          purpose: "Centralized networking (Transit Gateway, VPN)"

        - key: "security"
          name: "Security"
          email: "aws+security@mycompany.com"
          environment: "shared"
          purpose: "Security tooling (GuardDuty, Security Hub)"

  # Service Control Policies (Optional)
  serviceControlPolicies:
    - name: "DenyRootUser"
      description: "Prevent root user access"
      targetType: "OU"
      targetIds: ["production", "non-production"]
      policyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: "Deny"
            Action: "*"
            Resource: "*"
            Condition:
              StringLike:
                "aws:PrincipalArn": "arn:aws:iam::*:root"

  # Enabled policy types
  enabledPolicyTypes:
    - "SERVICE_CONTROL_POLICY"
    - "TAG_POLICY"

  # Tags for organization resources
  tags:
    ManagedBy: "CDK"
    Framework: "CodeIQLabs"

# ============================================================================
# DEPLOYMENT OPTIONS
# ============================================================================
options:
  enableAllAwsServices: true
  enableOrganizationCloudTrail: true
  enableOrganizationConfig: true
  enableOrganizationGuardDuty: true
  enableOrganizationSecurityHub: true
  defaultTags:
    Owner: "Platform Team"
    ManagedBy: "CDK"
    Project: "MyOrganization"
