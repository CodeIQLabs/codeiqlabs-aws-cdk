# Sample Manifest for Domain Delegation Stack
# This manifest creates Route53 hosted zones with cross-account DNS delegation
# Stack Created: DomainDelegationStack

# yaml-language-server: $schema=https://schemas.codeiqlabs.dev/aws/manifest.schema.json

# ============================================================================
# CORE CONFIGURATION
# ============================================================================
project: "MyOrganization"
company: "MyCompany"

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================
deployment:
  accountId: "123456789012" # Your AWS management account ID
  region: "us-east-1"

# ============================================================================
# DOMAIN MANAGEMENT CONFIGURATION
# ============================================================================
domains:
  enabled: true

  # List of registered domains to manage
  registeredDomains:
    # Primary domain
    - name: "mycompany.com"

      # Route53 hosted zone ID for the domain
      # Run: aws route53 list-hosted-zones
      hostedZoneId: "Z1234567890ABC"

      # Domain registrar
      registrar: "route53" # or "external"

      # Auto-renew domain registration
      autoRenew: true

      # ========================================================================
      # CROSS-ACCOUNT SUBDOMAIN DELEGATIONS
      # ========================================================================
      delegations:
        # Delegate staging.mycompany.com to non-production account
        - subdomain: "staging.mycompany.com"
          targetAccountId: "234567890123"
          targetRegion: "us-east-1"
          environment: "staging"
          description: "Staging environment subdomain"
          createNsRecords: true
          tags:
            Environment: "staging"
            Purpose: "Workload"

        # Delegate prod.mycompany.com to production account
        - subdomain: "prod.mycompany.com"
          targetAccountId: "345678901234"
          targetRegion: "us-east-1"
          environment: "prod"
          description: "Production environment subdomain"
          createNsRecords: true
          tags:
            Environment: "prod"
            Purpose: "Workload"

        # Delegate api.mycompany.com to API account
        - subdomain: "api.mycompany.com"
          targetAccountId: "456789012345"
          targetRegion: "us-east-1"
          environment: "prod"
          description: "API services subdomain"
          createNsRecords: true
          tags:
            Environment: "prod"
            Purpose: "API"

        # Delegate dev.mycompany.com to development account
        - subdomain: "dev.mycompany.com"
          targetAccountId: "567890123456"
          targetRegion: "us-east-1"
          environment: "dev"
          description: "Development environment subdomain"
          createNsRecords: true
          tags:
            Environment: "dev"
            Purpose: "Development"

      # ========================================================================
      # SSL CERTIFICATES
      # ========================================================================
      certificates:
        # Wildcard certificate for all subdomains
        - domains:
            - "*.mycompany.com"
            - "mycompany.com"
          validationMethod: "DNS"
          keyAlgorithm: "RSA_2048"
          autoRenew: true
          tags:
            Purpose: "Wildcard SSL"

        # Specific certificate for API
        - domains:
            - "api.mycompany.com"
            - "*.api.mycompany.com"
          validationMethod: "DNS"
          keyAlgorithm: "EC_prime256v1"
          autoRenew: true
          tags:
            Purpose: "API SSL"

      # Tags for domain resources
      tags:
        Domain: "Primary"
        ManagedBy: "CDK"

    # Secondary domain (if you have multiple domains)
    - name: "mycompany.io"
      hostedZoneId: "Z9876543210XYZ"
      registrar: "external"
      autoRenew: true

      delegations:
        - subdomain: "app.mycompany.io"
          targetAccountId: "234567890123"
          targetRegion: "us-east-1"
          environment: "prod"
          description: "Application subdomain"
          createNsRecords: true

      certificates:
        - domains:
            - "*.mycompany.io"
            - "mycompany.io"
          validationMethod: "DNS"
          keyAlgorithm: "RSA_2048"
          autoRenew: true

      tags:
        Domain: "Secondary"
        ManagedBy: "CDK"

  # Default tags for all domain resources
  defaultTags:
    Owner: "Platform Team"
    ManagedBy: "CDK"
    Framework: "CodeIQLabs"

# ============================================================================
# DEPLOYMENT OPTIONS
# ============================================================================
options:
  defaultTags:
    Owner: "Platform Team"
    ManagedBy: "CDK"
    Project: "MyOrganization"
