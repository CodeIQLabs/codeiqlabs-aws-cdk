# Complete Management Account Manifest
# This manifest combines Organizations, Identity Center, and Domain Delegation
# Stacks Created: ManagementOrganizationsStack, ManagementIdentityCenterStack, DomainDelegationStack

# yaml-language-server: $schema=https://schemas.codeiqlabs.dev/aws/manifest.schema.json

# ============================================================================
# CORE CONFIGURATION
# ============================================================================
project: "MyOrganization"
company: "MyCompany"

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================
deployment:
  accountId: "123456789012"
  region: "us-east-1"

# ============================================================================
# AWS ORGANIZATIONS
# ============================================================================
organization:
  enabled: true
  rootId: "r-abc123"
  mode: "create"
  featureSet: "ALL"

  organizationalUnits:
    - key: "production"
      name: "Production"
      accounts:
        - key: "prod-app"
          name: "Production Application"
          email: "aws+prod-app@mycompany.com"
          environment: "prod"
          purpose: "Production workloads"
          accountId: "234567890123"

    - key: "non-production"
      name: "Non-Production"
      accounts:
        - key: "staging"
          name: "Staging"
          email: "aws+staging@mycompany.com"
          environment: "staging"
          purpose: "Staging environment"
          accountId: "345678901234"

# ============================================================================
# AWS IDENTITY CENTER
# ============================================================================
identityCenter:
  enabled: true
  instanceArn: "arn:aws:sso:::instance/ssoins-1234567890abcdef"
  identityStoreId: "d-1234567890"

  users:
    - username: "admin.user"
      email: "admin@mycompany.com"
      givenName: "Admin"
      familyName: "User"
      displayName: "Admin User"

  permissionSets:
    - name: "AdministratorAccess"
      description: "Full administrator access"
      sessionDuration: "PT8H"
      managedPolicies:
        - "arn:aws:iam::aws:policy/AdministratorAccess"
      tags:
        Purpose: "Admin"

  assignments:
    - principalType: "USER"
      principalId: "admin.user"
      permissionSetName: "AdministratorAccess"
      targetType: "AWS_ACCOUNT"
      targetId: "234567890123"

  tags:
    ManagedBy: "CDK"

# ============================================================================
# DOMAIN MANAGEMENT
# ============================================================================
domains:
  enabled: true

  registeredDomains:
    - name: "mycompany.com"
      hostedZoneId: "Z1234567890ABC"
      registrar: "route53"
      autoRenew: true

      delegations:
        - subdomain: "staging.mycompany.com"
          targetAccountId: "345678901234"
          targetRegion: "us-east-1"
          environment: "staging"
          description: "Staging subdomain"
          createNsRecords: true

        - subdomain: "prod.mycompany.com"
          targetAccountId: "234567890123"
          targetRegion: "us-east-1"
          environment: "prod"
          description: "Production subdomain"
          createNsRecords: true

      certificates:
        - domains:
            - "*.mycompany.com"
            - "mycompany.com"
          validationMethod: "DNS"
          keyAlgorithm: "RSA_2048"
          autoRenew: true

      tags:
        Domain: "Primary"

# ============================================================================
# OPTIONS
# ============================================================================
options:
  enableAllAwsServices: true
  enableOrganizationCloudTrail: true
  enableOrganizationConfig: true
  requireMfaForIdentityCenter: true
  defaultTags:
    Owner: "Platform Team"
    ManagedBy: "CDK"
